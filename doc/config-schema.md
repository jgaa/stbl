## Config format

* YAML (`stbl.yaml`)
* Loaded once per site
* Fully validated before content processing

---

## Required fields

```yaml
site:
  id: string
  title: string
  base_url: string
  language: string
```

Missing required fields are **errors**.

### site.url_style

Controls how URLs and output paths are generated.

Allowed values:

- `html` (default)
  - Pages are generated as `/path/name.html`

- `pretty`
  - Pages are generated as `/path/name/index.html`
  - Links use `/path/name/`

- `pretty_with_fallback`
  - Same as `pretty`
  - Additionally generates `/path/name.html` as a redirect page
  - Intended for migrating existing sites without breaking links


## Full schema (MVP)

```yaml
site:
  id: string
  title: string
  tagline: string
  logo: string
  copyright: string  # optional; default "Copyright {YEAR} by {site.title}"
  base_url: string
  language: string
  timezone: string   # optional
  url_style: html   # default, safe for existing sites

theme:
  variant: string          # default "default"
  max_body_width: string   # default "72rem"
  breakpoints:
    desktop_min: string    # default "768px"
    wide_min: string       # default "1400px"
  colors:
    bg: string
    fg: string
    heading: string
    accent: string
    link: string
    muted: string
    surface: string
    border: string
    link_hover: string
    code_bg: string
    code_fg: string
    quote_bg: string
    quote_border: string
    wide_bg: string
  nav:
    bg: string
    fg: string
    border: string
  header:
    layout: stacked|inline  # default stacked
    menu_align: left|center|right
    # title_size: "1.3rem"
    # tagline_size: "1rem"
  wide_background:
    color: string
    image: string
    style: cover|tile
    position: string
    opacity: float

syntax:
  highlight: bool     # default true
  theme: string       # default "GitHub"
  line_numbers: bool  # default true

assets:
  cache_busting: bool  # default false

media:
  images:
    widths: [94, 128, 248, 360, 480, 640, 720, 950, 1280, 1440, 1680, 1920, 2560]
    # quality: 90

footer:
  show_stbl: bool   # default true, Controls whether the footer includes: `Generated by stbl on {YYYY-MM-DD}`

banner:
  widths: [int]   # default [94, 128, 248, 360, 480, 640, 720, 950, 1280, 1440, 1680, 1920, 2560]
  # quality: 90
  # align: 0
  # Note: banner images are full-bleed; `maxw`/`maxh` media constraints do not apply.

menu:
  - title: string
    href: string

people:
  default: "person1"
  entries:
    person1:
      name: "John Doe"
      email: "jdoe@example.com"
      links:
        - id: "website"
          name: "John Doe"
          url: "https://example.com/"
          icon: "icons/website.svg" # optional override for auto-selected icon

system:
  date:
    format: string
    roundup_seconds: int

publish:
  command: string

blog:
  abstract:
    enabled: bool     # default true
    max_chars: int    # default 200
  pagination:
    enabled: bool      # default false
    page_size: int     # default 10
  series:
    latest_parts: int  # default 3

rss:
  enabled: bool
  max_items: int
  ttl_channel: int  # optional, RSS <ttl> in minutes; omit or 0 to skip
  ttl_days: int     # optional, drop items older than N days since publish/update

seo:
  sitemap:
    priority:
      frontpage: int
      article: int
      series: int
      tag: int
      tags: int

comments:
  default: string      # optional provider name
  <provider>:
    template: string   # required; inline HTML or path to a template file
    <key>: string|number|bool  # provider-specific template variables
```

### assets.cache_busting

Type: boolean  
Default: `false`

When `false`, assets are written as-is:

```
artifacts/css/common.css
```

When `true`, asset filenames include a content-based hash:

```
artifacts/css/common.<hash>.css
```

Hashes are derived only from file contents, identical for all users, and do not vary per request.
This enables safe long-term caching on static hosting.

### media.images

`media.images.widths`

* Type: list of positive integers (pixels)
* Default: `[94, 128, 248, 360, 480, 640, 720, 950, 1280, 1440, 1680, 1920, 2560]`
* Widths are target max width; height is computed by aspect ratio.

`media.images.quality`

* Type: integer 1–100
* Default: `90`
* Applies to JPEG/WebP encoders; ignored for PNG.

---

### syntax

Controls fenced code block highlighting and styling.

`syntax.highlight`

* Type: boolean
* Default: `true`
* When `false`, fenced code blocks are rendered as plain escaped code.

`syntax.theme`

* Type: string
* Default: `"GitHub"`
* If empty, defaults to `"GitHub"`.
* If the theme is unknown, highlighting falls back to plain code blocks.

`syntax.line_numbers`

* Type: boolean
* Default: `true`
* When `true`, code blocks include line number markup (styled by `css/syntax.css`).

---

### security.svg

Controls SVG safety checks during asset copy.

`security.svg.mode`

* Type: string (`off`, `warn`, `fail`, `sanitize`)
* Default: `warn`
* `off`: copy SVGs unchanged without scanning
* `warn`: log warnings and copy unchanged
* `fail`: abort build if unsafe SVG content is detected
* `sanitize`: rewrite SVGs into a safer subset before copying

---

## RSS rules

* RSS is generated only if `rss.enabled: true`
* If enabled:

  * Missing required RSS fields → **error**
* Filtering:

  * `ttl_channel` controls the channel refresh hint in minutes (RSS <ttl>)
  * Apply `ttl_days` cutoff first (if present)
  * Then apply `max_items`

---

## Example `stbl.yaml`

```yaml
site:
  id: "lastviking-eu"          # mandatory and stable
  title: "The Last Viking LTD" # required
  tagline: "Software & Coffee at the Edge of the Universe"
  logo: "artifacts/logo.svg"
  base_url: "https://lastviking.eu/"  # required
  language: "en"               # required
  # timezone: "Europe/Sofia"   # optional; if omitted use local timezone

banner:
  widths: [94, 128, 248, 360, 480, 640, 720, 950, 1280, 1440, 1680, 1920, 2560]
  # quality: 90
  # align: 0

menu:
  - title: "Home"
    href: "./"
  - title: "Blog"
    href: "./blog.html"
  - title: "Freelancing"
    href: "https://cpp-freelancer.com/"
  - title: "Github"
    href: "https://github.com/john.doe"
  - title: "Contact"
    href: "./contact.html"
  - title: "About"
    href: "./about.html"

people:
  default: "jdoe"
  entries:
    jdoe:
      name: "John Doe"
      email: "jdoe@example.com"
      links:
        - id: "e-mail"
          name: "jdoe"
          url: "mailto:jdoe@example.com"
          icon: "{{rel}}artifacts/feather/mail.svg" # optional override
        - id: "github"
          name: "jgaa"
          url: "https://github.com/john.doe"
          icon: "{{rel}}artifacts/feather/github.svg" # optional override
        - id: "linkedin"
          name: "Jarle Aase"
          url: "https://www.linkedin.com/in/john.doe"
          icon: "{{rel}}artifacts/li123.svg" # optional override

security:
  svg:
    mode: "warn" # off | warn | fail | sanitize

system:
  date:
    format: "%A %B %e, %Y"
    roundup_seconds: 1800

publish:
  command: "rsync -a --delete {{local-site}}/ {{destination}}/"
  # {{local-site}} is the output dir, {{destination}} comes from --publish-to

blog:
  abstract:
    enabled: true
    max_chars: 200
  pagination:
    enabled: false
    page_size: 10
  series:
    latest_parts: 3

rss:
  enabled: true
  max_items: 16
  ttl_channel: 1800 # optional channel TTL in minutes
  # ttl_days: 30    # optional additional cutoff you requested

seo:
  sitemap:
    priority:
      frontpage: 100
      article: 90
      series: 95
      tag: 40
      tags: 80

comments:
  # default: "disqus"
  # disqus:
  #   template: "templates/disqus.html"
  #   src: "https://the-last-viking.disqus.com/embed.js"

```

## Migrating from `stbl.conf`

If you have a legacy `stbl.conf`, generate `stbl.yaml` with:

```
stbl_cli upgrade --source-dir <dir>
```

This writes a new `stbl.yaml` using the legacy values it can map and schema defaults for the rest.
